# jx-qndxx
简单易用的江西省青年大学习自动化脚本

# 特性
* <s>采用老页面接口, 可直接插入数据到后台</s> 老版本接口可能已经失效
* 支持班级批量学习, 一键完成大学习
* 执行完脚本后, 后台数据<s>可以及时同步</s>会在30分钟内同步

# 请自行测试`main.py`的有效性, 若无效请使用`newVersionDxx.py`

# `main.py`使用方法(可能已失效)
## 假定你会抓包并且已有抓包环境
* 开启抓包软件并开始捕获
* 打开现有的学习平台: `江西共青团 -> 网上团课 -> 青年大学习 -> 我的 -> 个人信息`
* 找到你的抓包软件的`/pub/vol/member/getUserInfo`这条记录
* 找到返回包中JSON字段`areaid4=N001145141919000`, 并记录下该值
* 修改代码27行的`nid`字段, 修改后27行应该形如`payload = {"course":id,"subOrg":None,"nid":"N001145141919000","cardNo":""}`
* 修改代码28行的列表, 将里面填充为你需要批量大学习的姓名, 修改后28行应该形如`name = ["张三", "李四", "王五", "赵六"]`

## 假定你不会抓包 (权限收回, 可能班级账号不能登录)
* 请联系你的团支部管理员, 通常为你的班长或团支书
* 请Ta登录青年大学习服务平台, 并点击`团课管理 -> 组织管理 -> 你的团支部 -> 负责人姓名`
* `负责人姓名`处的值即为27行应该修改的`nid`的值
* 修改代码27行的`nid`字段, 修改后27行应该形如`payload = {"course":id,"subOrg":None,"nid":"N001145141919000","cardNo":""}`
* 修改代码28行的列表, 将里面填充为你需要批量大学习的姓名, 修改后28行应该形如`name = ["张三", "李四", "王五", "赵六"]`
![](https://s2.loli.net/2023/02/27/6I1k4gdReqHLUBl.png)

# `newVersionDxx.py`使用方法

首先需要强调, 在最近一次更新后, 要在大学习后台插入学习继续需要满足以下几个条件
+ 需要在系统填写以下个人信息

![](https://s3.bmp.ovh/imgs/2023/07/14/90d3a3f27f8e27e7.png)
+ 发送一条到`http://www.jxqingtuan.cn/pub/pub/vol/member/addScoreInfo`的请求用于获取积分
+ 发送一条到`http://www.jxqingtuan.cn/pub/pub/vol/volClass/join?accessToken=`的请求用于记录学习
+ 并且以上两条请求中的信息必须和系统中填写的完全一致, 否则无法成功插入

在以上过程中需要用到的信息有`userId`, `姓名`, `组织代码`, `openId`, `学号`

在老版本上新增加需要的信息为`userId`, `openId`, `学号`, 而前两项的获取是最为麻烦的

## `userId`, `openId`等的获取
打开抓包软件后打开大学习界面, 仅需要停留在首页, 此时查看抓包结果

找到`http://www.jxqingtuan.cn/pub/pub/vol/member/info?accessToken=xxx`的抓包结果, 应该形如

![](https://s3.bmp.ovh/imgs/2023/07/14/0d34b95cc1dbafa8.png)

图中标注出的信息即为所需要的

## 使用方法
* 获取`userId`, `姓名`, `组织代码`, `openId`, `学号`等信息
* 打开`newVersionDxx.py`, 找到第7行的stuInfo, 按顺序填入信息, 例如
```
stuInfo = [  # 数据结构 ["学号", "姓名", "openId", "组织代码", "userId"]
    ["111222333", "野兽先辈", "=oc2p4795ba88ecda2", "N0088001145141919", "114514"],
]
```
* 运行脚本, 学习记录将在30分钟内显示在后台

# 最佳实践
* 将信息填完并测试脚本可以正常工作
* 在宝塔面板添加一个计划任务, 工作时间为`每周一, 12点30分执行`
